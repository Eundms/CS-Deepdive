# ë™ê¸°í™” ì•Œê³ ë¦¬ì¦˜ 
## ë°ì»¤(Dekker) ì•Œê³ ë¦¬ì¦˜ 
> flagì™€ turn ë³€ìˆ˜ë¥¼ í†µí•´ ì„ê³„ êµ¬ì—­ì— ë“¤ì–´ê°ˆ í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ ê²°ì •
- flag : í”„ë¡œì„¸ìŠ¤ ì¤‘ ëˆ„ê°€ ì„ê³„ì˜ì—­ì— ì§„ì…í•  ê²ƒì¸ì§€ 
- turn : ëˆ„ê°€ ì„ê³„êµ¬ì—­ì— ë“¤ì–´ê°ˆ ì°¨ë¡€ì¸ì§€ 

```java
class Dekker {
    private volatile boolean[] flag = {false, false}; // í”„ë¡œì„¸ìŠ¤ ì¤€ë¹„ ìƒíƒœ
    private volatile int turn = 0; // ëˆ„ê°€ ì‹¤í–‰í•  ì°¨ë¡€ì¸ì§€

    public void criticalSection(int id) {
        int other = 1 - id; // ìƒëŒ€ë°© í”„ë¡œì„¸ìŠ¤ ID

        flag[id] = true; // ìì‹ ì´ ì„ê³„ ì˜ì—­ì— ë“¤ì–´ê°ˆ ì¤€ë¹„ ì™„ë£Œ

        while (flag[other]) { // ìƒëŒ€ë°©ì´ ì„ê³„ ì˜ì—­ì„ ì‚¬ìš© ì¤‘ì´ë©´ ëŒ€ê¸°
            if (turn != id) { 
                flag[id] = false;
                while (turn != id); // ìì‹ ì˜ ì°¨ë¡€ê°€ ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
                flag[id] = true;
            }
        }

        // ğŸ”´ ì„ê³„ ì˜ì—­ (Critical Section)
        System.out.println("Thread " + id + " is in critical section");

        // ğŸ”µ ì¢…ë£Œ í›„ turn ë³€ê²½
        turn = other;
        flag[id] = false;
    }
}

public class DekkerExample {
    public static void main(String[] args) {
        Dekker dekker = new Dekker();

        Runnable task1 = () -> {
            for (int i = 0; i < 5; i++) dekker.criticalSection(0);
        };

        Runnable task2 = () -> {
            for (int i = 0; i < 5; i++) dekker.criticalSection(1);
        };

        Thread t1 = new Thread(task1);
        Thread t2 = new Thread(task2);

        t1.start();
        t2.start();
    }
}
```

## í”¼í„°ìŠ¨(Peterson) ì•Œê³ ë¦¬ì¦˜
> ë°ì»¤ì™€ ìœ ì‚¬í•˜ì§€ë§Œ, ìƒëŒ€ë°© í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œì—ê²Œ ì§„ì… ê¸°íšŒë¥¼ ì–‘ë³´í•˜ëŠ” ê²ƒì— ì°¨ì´ê°€ ìˆìŒ

```java
class Peterson {
    private volatile boolean[] flag = {false, false}; // í”„ë¡œì„¸ìŠ¤ ì¤€ë¹„ ìƒíƒœ
    private volatile int turn = 0; // ëˆ„ê°€ ì‹¤í–‰í•  ì°¨ë¡€ì¸ì§€

    public void criticalSection(int id) {
        int other = 1 - id; // ìƒëŒ€ë°© í”„ë¡œì„¸ìŠ¤ ID

        flag[id] = true; // ìì‹ ì˜ ì§„ì… ì˜ì‚¬ ì„¤ì •
        turn = other; // ìƒëŒ€ë°©ì—ê²Œ ê¸°íšŒ ì–‘ë³´

        while (flag[other] && turn == other) {
            // ëŒ€ê¸° (ìƒëŒ€ë°©ì´ ì„ê³„ ì˜ì—­ì„ ì‚¬ìš© ì¤‘ì´ë©´ ê¸°ë‹¤ë¦¼)
        }

        // ğŸ”´ ì„ê³„ ì˜ì—­
        System.out.println("Thread " + id + " is in critical section");

        flag[id] = false; // ì„ê³„ ì˜ì—­ ì‚¬ìš© ì¢…ë£Œ
    }
}

public class PetersonExample {
    public static void main(String[] args) {
        Peterson peterson = new Peterson();

        Runnable task1 = () -> {
            for (int i = 0; i < 5; i++) peterson.criticalSection(0);
        };

        Runnable task2 = () -> {
            for (int i = 0; i < 5; i++) peterson.criticalSection(1);
        };

        Thread t1 = new Thread(task1);
        Thread t2 = new Thread(task2);

        t1.start();
        t2.start();
    }
}
```

## ì œê³¼ì (Bakery) ì•Œê³ ë¦¬ì¦˜
> ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œì— ëŒ€í•œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•œ ì•Œê³ ë¦¬ì¦˜
> ê°€ì¥ ì‘ì€ ìˆ˜ì˜ ë²ˆí˜¸í‘œë¥¼ ê°€ì§€ê³  ìˆëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„ êµ¬ì—­ì— ì§„ì…

```java
import java.util.Arrays;

class Bakery {
    private volatile boolean[] choosing;
    private volatile int[] ticket;
    private int numThreads;

    public Bakery(int numThreads) {
        this.numThreads = numThreads;
        choosing = new boolean[numThreads];
        ticket = new int[numThreads];
        Arrays.fill(ticket, 0);
    }

    public void lock(int id) {
        choosing[id] = true;

        // ìµœëŒ€ ticket ê°’ì„ ì°¾ì•„ +1 ë¶€ì—¬
        ticket[id] = Arrays.stream(ticket).max().orElse(0) + 1;
        choosing[id] = false;

        for (int i = 0; i < numThreads; i++) {
            if (i == id) continue;

            // ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ticketì„ í• ë‹¹ ì¤‘ì´ë©´ ëŒ€ê¸°
            while (choosing[i]);

            // ìš°ì„ ìˆœìœ„: (1) ticket ê°’ì´ ì‘ì€ í”„ë¡œì„¸ìŠ¤, (2) ticket ê°’ì´ ê°™ìœ¼ë©´ IDê°€ ì‘ì€ í”„ë¡œì„¸ìŠ¤ ìš°ì„ 
            while (ticket[i] != 0 && (ticket[i] < ticket[id] || (ticket[i] == ticket[id] && i < id)));
        }
    }

    public void unlock(int id) {
        ticket[id] = 0; // ì„ê³„ êµ¬ì—­ ì‚¬ìš© ì¢…ë£Œ
    }
}

public class BakeryExample {
    public static void main(String[] args) {
        int numThreads = 3;
        Bakery bakery = new Bakery(numThreads);

        Runnable task = (id -> {
            for (int i = 0; i < 5; i++) {
                bakery.lock(id);
                System.out.println("Thread " + id + " is in critical section");
                bakery.unlock(id);
            }
        });

        Thread[] threads = new Thread[numThreads];
        for (int i = 0; i < numThreads; i++) {
            final int id = i;
            threads[i] = new Thread(() -> task.run(id));
        }

        for (Thread t : threads) t.start();
    }
}
```