# 트랜스포트 계층(4계층) 서비스 및 개요
- 전송 계층(Transport layer)은 계층 구조의 네트워크 구성요소와 프로토콜 내에서 송신자와 수신자를 연결하는 통신 서비스를 제공
    - 서로 다른 호스트에서 동작하는 애플리케이션 프로세스들 간의 `논리적 통신(logical communication)`을 제공
        - 논리적 통신은 애플리케이션 관점에서 보면 프로세스들을 동작하는 호스트들이 직접 연결된 것처럼 보인다는 것
- 네트워크 라우터가 아닌 종단 시스템에서 구현됨
- `애플리케이션 메시지`를 `트랜스포트 계층 세그먼트`로 만들기 위해 작은 조각으로 `분할`하고 각각의 조각에 `트랜스포트 계층 헤더를 추가`하여 `네트워크 계층으로 전달`
    - 즉, `세그먼트`는 `네트워크 계층 패킷 안에 캡슐화`되어 목적지로 전달됨

## 트랜스포트 계층(4)과 네트워크 계층(3) 사이의 관계
> 네트워크 계층 프로토콜(3)은 `호스트들 사이의 논리적 통신`을   
> 트랜스포트 계층 프로토콜(4)은 `서로 다른 호스트에서 동작하는 프로세스들 사이의 논리적 통신`을 제공  
> ex) 두 집간의 논리적 통신 = 네트워크 계층 프로토콜, 전달된 편지를 통한 사람들끼리의 통신 = 트랜스포트 계층 프로토콜

- 트랜스포트 계층 프로토콜은 프로세스끼리 전송하는 메시지에 대한 `지연 보장`이나 `대역폭 보장`을 네트워크 계층 프로토콜에 `의존하여 보장`함
    - 단, 네트워크 프로토콜이 `비신뢰적(패킷 분실, 손상)`일때도 트랜스포트 계층 프로토콜은 애플리케이션에게 `신뢰적인 데이터 전송 서비스`를 `제공`할 수 있음

## 인터넷 트랜스포트 계층의 개요
- 트랜스포트 계층 프로토콜(4)
    - UDP(User Datagram Protocol) : 애플리케이션에게 비신뢰적이고 비연결형인 서비스 제공
    - TCP(Transmission Control Protocol) : 애플리케이션에게 신뢰적이고 연결지향형 서비스 제공
- 네트워크 계층 프로토콜(3)
    - IP : 호스트들 간에 논리적 통신을 제공하는 `최선형 전달 서비스(best-effort delivery service)`
        - IP가 통신하는 호스트들 간에 세그먼트를 전달하기 위해서 최대한 노력하지만... `전달`, `순서 전달`, `무결성`을 보장하지 않음
        - 따라서, `비신뢰적인 서비스(unreliable service)`라고 부름 

### 트랜스포트 계층 프로토콜 기능
1. `트랜스포트 다중화(Transport Multiplexing)`, `역다중화(Multiplexing)`
    - 종단 시스템 사이의 IP 전달 서비스를 종단 시스템에서 동작하는 두 프로세스 간의 전달 서비스로 확장하는 것   
      (호스트-대-호스트 전달 <=> 프로세스-대-프로세스 전달)
2. 헤더에 `오류 검출 필드`를 포함함으로써 무결성 검사 제공

### TCP 프로토콜
- 신뢰적인 데이터 전달(reliable data trasfer) 제공
    - 흐름제어, 순서번호, 확인응답, 타이머
- 혼잡제어(congestion control) 
    - 한 TCP 연결이 과도한 양의 트래픽으로 모든 통신하는 호스트들 사이의 스위치와 링크를 폭주되게 하는 것을 방지

# 다중화와 역다중화
- 트랜스포트 계층(4)은 네트워크 계층(3)으로부터 세그먼트를 수신하여 호스트에서 동작하는 해당 애플리케이션 프로세스에게 세그먼트의 데이터를 전달하는 의무를 가짐
- 네트워크 애플리케이션의 한 부분으로서 프로세스가 소켓을 통해 통신을 진행하게 됨
    - `역다중화(demultiplexing)` : 트랜스포트 계층(4) 세그먼트의 데이터를 올바른 소켓으로 전달하는 작업
    - `다중화(multiplexing)` : 소켓으로부터 데이터를 모으고 세그먼트를 생성하기 위해 각 데이터에 헤더 정보를 캡슐화하고 이를 네트워크 계층(3)으로 전달하는 작업
 
## `비연결형 다중화/역다중화`와 `연결형 다중화/역다중화` 서비스 구현  
- 소켓은 유일한 식별자를 가짐
- 비연결형 다중화/역다중화
    - 소스 포트 번호, 목적지 포트 번호
    - 오버헤드 적음
    - 스트리밍, DNS, VoIP
- 연결형 다중화/역다중화
    - 소스 IP, 목적지 IP, 소스 포트, 목적지 포트
    - 오버헤드 높음
    - 파일 전송, HTTP 요청, 이메일

# 비연결형 트랜스포트 : UDP
- DNS는 UDP를 사용하는 애플리케이션 계층 프로토콜의 예
    - DNS 질의 메시지를 작성하고 UDP에게 메시지를 넘겨주면 메시지에 헤더 필드를 추가한 후에 최종 세그먼트를 네트워크 계층에 넘겨주고 네트워크 계층은 UDP 세그먼트를 데이터그램으로 캡슐화하고 네임서버에 데이터그램을 송신한다. 이때, 질의 호스트에서의 DNS 애플리케이션은 질의에 대한 응답을 기다린다.
- 연결 설정, 연결 상태 X

## UDP 세그먼트 구조 
- 체크섬 : 세그먼트에 오류가 발생했는지 검사하기 위한 필드
    - 종단 간의 트랜스포트계층(4)에서 오류 검사 제공  
![alt text](image-1.png)

## UDP 체크섬 계산
- 모든 16비트 워드 단위로 더함 -> 1의 보수 수행 (윤회식 자리올림)  

# 신뢰성 있는 데이터 전송의 원리
## 신뢰적인 데이터 전송 프로토콜 (reliable data transfer protocol) 구축
- rdt1.0: 완벽한 신뢰 채널
    - 오류가 생길 수 없으므로 수신 측이 송신 측에게 어떤 피드백(feedback)도 제공할 필요가 없음
- rdt2.0: 비트 오류가 있는 채널 상에서의 신뢰적 데이터 전송
    - `ARQ(Automatic Repeat reQuest) 프로토콜` : 컴퓨터 네트워크 설정에서 재전송을 기반으로 하는 신뢰적인 데이터 전송 프로토콜
        - 오류 검출 : 비트 오류를 수신자가 검출할 수 있어야 함
        - 수신자 피드백 : ACK, NAK과 같은 수신자 상태를 알기 위한 방법
        - 재전송 : 수신자에서 오류를 가지고 수신된 패킷은 송신자에 의해서 재전송됨
    - == `전송 후 대기(stop-and-wait) 프로토콜` : 하나의 데이터를 전송하고 피드백을 받기 전까지 다음 데이터를 보내지 않는 방식
    - 문제점 : 수신자 피드백을 나타내는 패킷도 손상될 수 있음
    - 해결방안 
        - 1) 왜곡된 ACK, NAK 패킷을 수신할 때 현재 데이터 패킷을 단순히 다시 송신 : `중복 패킷`
        - 2) `순서번호(sequence number)` 삽입 : 데이터패킷에 송신자가 번호를 붙이기
- rdt3.0: 비트 오류, 손실 있는 채널 상에서의 신뢰적 데이터 전송
    - 카운트다운 타이머(countdown timer) : 주어진 시간이 경과된 후에 송신자 중단
    - == `얼터네이팅 비트 프로토콜(alternating-bit protocol)`

## 파이프라인된 신뢰적 데이터 전송 프로토콜
- 파이프라이닝, 필요한 순서번호의 범위와 버퍼링 조건은 데이터 전송 프로토콜이 손실 패킷과 손상 패킷    그리고 상당히 지연된 패킷들에 대해 응답하는 방법에 의존함
- 파이프라인 오류 회복 2가지 기법 : `N부터 반복(Go-Back-N)`, `선택적 반복(Selective Repeat, SR)` 

### N부터 반복(Go-Back-N) : `p.203 ~`
- 

### 선택적 반복(Selective Repeat, SR)
- 

