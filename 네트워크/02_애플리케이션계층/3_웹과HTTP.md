# HTTP(HyperText Transfer Protocol)
> `메시지의 구조`, `클라이언트와 서버가 메시지 교환하는 방식`에 대한 정의
- 서버에 `TCP 연결`을 시작,  연결이 이루어지면 브라우저와 서버 프로세스는 `소켓 인터페이스`를 통해 TCP로 접속함

## 특징
- `Stateless` : 클라이언트에 대한 정보를 유지하지 않음

### 비지속 연결과 지속 연결
각 요구/응답 쌍이 `분리된 TCP 연결(비지속 연결)`을 통해 보내져야 하는가 or `같은 TCP 연결(지속 연결)`상으로 보내져야 하는가 에 대한 논의  

#### 0. RTT(Round-Trip Time) 
- 클라이언트에서 서버로 가고 다시 클라이언트로 되돌아오는 데 걸리는 시간

#### 1. 비지속 연결
> 각 TCP 연결은 하나의 요청 메시지와 하나의 응답 메시지만 전송한다

- 비지속 연결 과정 예시
    1. HTTP의 기본 포트 번호 80을 통해 www.naver.com 서버로 TCP 연결을 시도한다. 
    TCP연결과 관련하여 클라이언트와 서버에 각각 소켓이 있다.
    2. HTTP 클라이언트는 1단계에서 설정된 TCP연결 소켓을 통해 서버로 HTTP 요청 메시지를 보낸다.(/home.index)  
    3. HTTP 서버는 1단계에서 설정된 연결 소켓을 통하여 요청 메시지를 받는다. 저장장치로부터 /home.index 객체를 추출한다.
        HTTP 응답 메시지에 객체를 캡슐화하고 응답 메시지를 소켓을 통해 클라이언트로 보낸다.
    4. HTTP 서버는 TCP에게 TCP연결을 끊으라고 한다.
    5. HTTP 클라이언트가 응답 메시지를 받으면 TCP연결이 중단된다. 응답 메시지로부터 HTML과 10개의 JPEG 객체에 대한 참조를 찾고 다시 1-4단계를 반복한다.

- TCP 연결 설정에 `1RTT`, 객체를 요청하고 받는 데 `1RTT` 필요
- 연결을 계속 새로 해야 해서 비효율적이다 

#### 2. 지속 연결 ⭐
-  `HTTP1.1` : 파이프라이닝을 활용한 지속 연결 
    - 응답을 보낸 후에 TCP 연결을 그대로 유지함
    - 연결된 요구를 수신할 때, 서버는 객체를 연속해서 보냄

-  `HTTP/2` 지속 연결
    - 같은 연결상태에서 다중 요청(request)와 응답(reply)이 가능
    -  HTTP 메시지 요청과 응답의 우선 순위 기법이 가능하도록  HTTP1.1 기반으로 제안됨

## HTTP 메시지 포멧

### 1. 요청 메시지 포멧
- 구조 : 요청라인(method, URL, HTTP버전) | 헤더라인(어떤 호스트에 객체가 존재하는지) | CR LF | 개체 몸체

#### 요청라인
##### 메서드 (방식)
- GET : URL 필드로 식별되는 객체를 요청할 때 사용
- POST : body에 값을 넣어 사용
- `HEAD` : GET과 거의 비슷, `HTTP 메시지로 응답`, 디버깅 용도로 사용
- PUT : 웹서버에 객체를 업로드하기 위해 사용
- DELETE : 웹서버에 있는 객체 지우기 위해 사용 

#### 헤더라인 
- `호스트 헤더라인`이 제공하는 정보는 `웹 프록시 캐시`에서 필요
    - `Connection : close` : 브라우저가 지속 연결 사용을 원치 않음을 명시
    - `User-agent` : 서버에게 요청을 하는 브라우저 타입 명시
        - 서버가 같은 객체에 대한 다른 버전을 다른 타입의 사용자 에이전트에게 보낼 수 있음  
    - `Accept-language` : 언어 버전 명시

#### 개체 몸체
- GET 방식에서 비어있음
- POST 방식에서 사용

## 2. 응답 메시지 포멧 
- 구조 : 상태라인(버전, 상태코드, 문장) | 헤더라인 | CR LF | 개체 몸체

### 상태라인 
- 상태코드 
    - 301(Moved Permanently) : 요청 객체가 영구적으로 이동, 새로운 URL은 응답 메시지의 Location 헤더에 나와 있음
    - 304(Not Modified)
    - 505(HTTP Version Not Supported) : HTTP  프로토콜 버전을 서버가 지원하지 않음


# 그외
## 쿠키
- HTTP 상태를 유지하지 않으므로 웹 사이트가 `사용자를 확인하도록 Cookie를 사용`함
    - 비상태 위에서 사용자 세션 계층을 생성하는데 이용될 수 있음
1) HTTP 응답 메시지 쿠키 헤더 라인
2) HTTP 요청 메시지 쿠키 헤더 라인
3) 사용자의 브라우저에 사용자 종단 시스템과 관리를 지속시키는 쿠키 파일
4) 웹 사이트의 백엔드 데이터베이스

## 웹 캐싱
- Origin Web Server를 대신하여 HTTP 요구를 충족시키는 네트워크 개체
- 응답 시간과 웹 트래픽을 줄일 수 있음
- CDN(Content Distribution Network) : 지리적으로 가까운 클러스터 할당

### `조건부 GET 방식`을 사용하여 모든 객체들이 최신의 것임을 확인하며 캐싱함
> 조건부 GET : (1) GET 방식 (2) If-Modified-Since 헤더라인 

#### 동작 방식
1. 브라우저의 요청을 대신해 프록시 캐시는 요청 메시지를 웹 서버로 보낸다
- 이때, 캐시가 객체와 더불어 마지막으로 수정된 날짜를 함께 저장한다  
2. 웹 서버는 캐시에게 객체를 가진 응답 메시지를 보낸다 
3. 일주일 후에 다른 브라우저가 같은 객체를 캐시에게 요청하면 객체는 여전히 저장되어 있다 

지난주에 웹 서버에서 수정되었으므로 조건부 GET으로 갱신 조사를 수행한다 

```text
GET /fruit/a.gif HTTP/1.1
HOST : www.example.com
If-modified-since: Wed, 7 Sep 2022 09:23:23
```

만약에 갱신되었으면 객체를 보내고 아니면 아래와 같은 메시지를 보낸다 (캐시된 거 사용해~)

```text
HTTP/1.1 304 Not Modified
Date: Sat, 15 Oct 2011 15:39:19
Server: Apache/1.3.0 (Unix)

(빈 개체 몸체)
```